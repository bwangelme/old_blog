<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>urfave/cli 学习笔记 - 大白的碎碎念</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="bwangel" /><meta name="description" content="  原文地址: https://github.com/urfave/cli/tree/v1.20.0#overview  " /><meta name="keywords" content="Hugo, blog, bwangel" />






<meta name="generator" content="Hugo 0.54.0 with theme even" />


<link rel="canonical" href="/2019/04/21/go-cli/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.0e5e4d97.min.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="urfave/cli 学习笔记" />
<meta property="og:description" content="

原文地址: https://github.com/urfave/cli/tree/v1.20.0#overview

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2019/04/21/go-cli/" />
<meta property="article:published_time" content="2019-04-21T18:23:00&#43;08:00"/>
<meta property="article:modified_time" content="2019-04-21T18:23:00&#43;08:00"/>

<meta itemprop="name" content="urfave/cli 学习笔记">
<meta itemprop="description" content="

原文地址: https://github.com/urfave/cli/tree/v1.20.0#overview

">


<meta itemprop="datePublished" content="2019-04-21T18:23:00&#43;08:00" />
<meta itemprop="dateModified" content="2019-04-21T18:23:00&#43;08:00" />
<meta itemprop="wordCount" content="3741">



<meta itemprop="keywords" content="Go,cli,ARTS," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="urfave/cli 学习笔记"/>
<meta name="twitter:description" content="

原文地址: https://github.com/urfave/cli/tree/v1.20.0#overview

"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Keep Foolish</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/leetcode/">
        <li class="mobile-menu-item">LeetCode</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/translate/">
        <li class="mobile-menu-item">翻译</li>
      </a><a href="/life/">
        <li class="mobile-menu-item">随笔</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Keep Foolish</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/leetcode/">LeetCode</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/translate/">翻译</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/life/">随笔</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">urfave/cli 学习笔记</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-04-21 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#环境说明">环境说明</a></li>
<li><a href="#指定版本">指定版本</a></li>
<li><a href="#基本用法">基本用法</a></li>
<li><a href="#添加全局-flag">添加全局 flag</a></li>
<li><a href="#在-usage-中放上占位符">在 Usage 中放上占位符</a></li>
<li><a href="#flag-的别名">Flag 的别名</a></li>
<li><a href="#排序">排序</a></li>
<li><a href="#从环境变量中获取值">从环境变量中获取值</a></li>
<li><a href="#从文件中读取配置项">从文件中读取配置项</a></li>
<li><a href="#子命令">子命令</a></li>
<li><a href="#子命令分类">子命令分类</a></li>
<li><a href="#返回码">返回码</a></li>
<li><a href="#生成帮助文本">生成帮助文本</a></li>
<li><a href="#版本标志">版本标志</a></li>
<li><a href="#示例代码">示例代码</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<ul>
<li>原文地址: <a href="https://github.com/urfave/cli/tree/v1.20.0#overview">https://github.com/urfave/cli/tree/v1.20.0#overview</a></li>
</ul>
</blockquote>

<h2 id="环境说明">环境说明</h2>

<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>

<tbody>
<tr>
<td>cli 版本</td>
<td>v1.20.0</td>
</tr>

<tr>
<td>cli Git Commit</td>
<td><a href="https://github.com/urfave/cli/commit/cfb38830724cc34fedffe9a2a29fb54fa9169cd1">cfb38830724cc34fedffe9a2a29fb54fa9169cd1</a></td>
</tr>

<tr>
<td>Go 版本</td>
<td>go version go1.11.5 darwin/amd64</td>
</tr>
</tbody>
</table>

<h2 id="指定版本">指定版本</h2>

<ul>
<li>指定<code>V2</code>版本(注意：V2 版本目前(2019年04月21日)还在开发中，属于<code>unstable</code>状态)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ go get gopkg.in/urfave/cli.v2</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="o">...</span>
<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;gopkg.in/urfave/cli.v2&#34;</span> <span class="c1">// imports as package &#34;cli&#34;
</span><span class="c1"></span><span class="p">)</span>
<span class="o">...</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>指定<code>V1</code>版本</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ go get gopkg.in/urfave/cli.v1</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="o">...</span>
<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span> <span class="c1">// imports as package &#34;cli&#34;
</span><span class="c1"></span><span class="p">)</span>
<span class="o">...</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="基本用法">基本用法</h2>

<ul>
<li>下面的代码没有添加 command，只有一个默认的动作。</li>
<li>所有命令后跟着的参数都会被放到 <code>c.Args</code> 中</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;watch&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&#34;fight the loneliness!&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Hello %q!&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="添加全局-flag">添加全局 flag</h2>

<ul>
<li>下面的代码中添加了全局的<strong>flag</strong>: <code>--lang</code></li>
<li><strong>flag</strong>的<code>Value</code>既可以通过<code>Destination</code>属性存储到自定义变量中，也可以使用<code>c.String(&quot;lang&quot;)</code>的方式来获取</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="kd">var</span> <span class="nx">language</span> <span class="kt">string</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;lang&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span> <span class="s">&#34;english&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;language for the greeting&#34;</span><span class="p">,</span>
			<span class="nx">Destination</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">language</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="nx">name</span> <span class="o">:=</span> <span class="s">&#34;bwangel&#34;</span>
		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">NArg</span><span class="p">()</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="nx">name</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="c1">// if c.String(&#34;lang&#34;) == &#34;chinese&#34; {
</span><span class="c1"></span>		<span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="s">&#34;chinese&#34;</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;你好&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="在-usage-中放上占位符">在 Usage 中放上占位符</h2>

<ul>
<li>有时候我们想在<code>Usage</code>中放上<strong>flag</strong>的<code>Value</code>占位符，可以在<code>Usage</code>中放置反引号包裹的内容</li>
<li>这段代码输出的<code>Usage</code>如下:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></pre></td>
<td class="lntd">
<pre class="chroma">GLOBAL OPTIONS:
   --config YOUR_CONFIG_FILE, -c YOUR_CONFIG_FILE  Load configuration from YOUR_CONFIG_FILE
   --help, -h                                      show help
   --version, -v                                   print the version</pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;config, c&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;Load configuration from `YOUR_CONFIG_FILE`&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="flag-的别名">Flag 的别名</h2>

<ul>
<li>有时候我们想要让一个 flag 有多个名称，例如<code>language</code>, <code>lang</code>, <code>l</code>，可以在<code>Name</code>中指定多个由<strong>逗号</strong>分割的名称，cli 将会自动为其创建别名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;greet&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&#34;A greeting app&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;language, lang, l&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span> <span class="s">&#34;english&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;language for greeting&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c1">//GLOBAL OPTIONS:
</span><span class="c1"></span>	<span class="c1">//--language value, --lang value, -l value  language for greeting (default: &#34;english&#34;)
</span><span class="c1"></span>	<span class="c1">//--help, -h                                show help
</span><span class="c1"></span>	<span class="c1">//--version, -v                             print the version
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意，<strong>同一个命令中的 flag 名称</strong>不能被定义两次，否则将会导致 panic</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;greet&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&#34;A greeting app&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;language, lang, l&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span> <span class="s">&#34;english&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;language for greeting&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">Int64Flag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;length, l&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;length of users&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c1">//Out
</span><span class="c1"></span>	<span class="c1">//	&gt;&gt;&gt; go build &amp;&amp; ./watcher
</span><span class="c1"></span>	<span class="c1">//	greet flag redefined: l
</span><span class="c1"></span>	<span class="c1">//	panic: greet flag redefined: l
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">//	goroutine 1 [running]:
</span><span class="c1"></span>	<span class="c1">//	flag.(*FlagSet).Var(0xc000084180, 0x1175d40, 0xc000074018, 0x1153226, 0x1, 0x1153f78, 0xf)
</span><span class="c1"></span>	<span class="c1">//	/usr/local/opt/go/libexec/src/flag/flag.go:805 +0x529
</span><span class="c1"></span>	<span class="c1">//	flag.(*FlagSet).Int64Var(0xc000084180, 0xc000074018, 0x1153226, 0x1, 0x0, 0x1153f78, 0xf)
</span><span class="c1"></span>	<span class="c1">//	/usr/local/opt/go/libexec/src/flag/flag.go:630 +0x71
</span><span class="c1"></span>	<span class="c1">//	flag.(*FlagSet).Int64(0xc000084180, 0x1153226, 0x1, 0x0, 0x1153f78, 0xf, 0x1)
</span><span class="c1"></span>	<span class="c1">//	/usr/local/opt/go/libexec/src/flag/flag.go:643 +0x77
</span><span class="c1"></span>	<span class="c1">//	gopkg.in/urfave/cli.v1.Int64Flag.ApplyWithError.func1(0x1153226, 0x1)
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/go/pkg/mod/gopkg.in/urfave/cli.v1@v1.20.0/flag.go:488 +0xad
</span><span class="c1"></span>	<span class="c1">//	gopkg.in/urfave/cli.v1.eachName(0x115321e, 0x9, 0xc0000a7b88)
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/go/pkg/mod/gopkg.in/urfave/cli.v1@v1.20.0/flag.go:94 +0xc6
</span><span class="c1"></span>	<span class="c1">//	gopkg.in/urfave/cli.v1.Int64Flag.ApplyWithError(0x115321e, 0x9, 0x1153f78, 0xf, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc000084180, ...)
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/go/pkg/mod/gopkg.in/urfave/cli.v1@v1.20.0/flag.go:483 +0x113
</span><span class="c1"></span>	<span class="c1">//	gopkg.in/urfave/cli.v1.flagSet(0x115293c, 0x5, 0xc000076080, 0x4, 0x4, 0xc000062190, 0x1, 0x1)
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/go/pkg/mod/gopkg.in/urfave/cli.v1@v1.20.0/flag.go:80 +0x128
</span><span class="c1"></span>	<span class="c1">//	gopkg.in/urfave/cli.v1.(*App).Run(0xc000078340, 0xc000062190, 0x1, 0x1, 0x0, 0x0)
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/go/pkg/mod/gopkg.in/urfave/cli.v1@v1.20.0/app.go:187 +0xfa
</span><span class="c1"></span>	<span class="c1">//	main.main()
</span><span class="c1"></span>	<span class="c1">//	/Users/michaeltsui/Github/Golang/watcher/main.go:28 +0x22d
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="排序">排序</h2>

<p><code>flags</code>和<code>commands</code>默认是根据定义的顺序展示的，但是如果让他们按照字母顺序输出，可以使用<code>FlagsByName</code>和<code>CommandsByName</code>和<code>sort</code>来排序。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;sort&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;lang, l&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span> <span class="s">&#34;english&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;Language for the greeting&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;config, c&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;Load configuration from `FILE`&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Commands</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>    <span class="s">&#34;complete&#34;</span><span class="p">,</span>
			<span class="nx">Aliases</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;c&#34;</span><span class="p">},</span>
			<span class="nx">Usage</span><span class="p">:</span>   <span class="s">&#34;complete a task on the list&#34;</span><span class="p">,</span>
			<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Command</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>    <span class="s">&#34;add&#34;</span><span class="p">,</span>
			<span class="nx">Aliases</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">},</span>
			<span class="nx">Usage</span><span class="p">:</span>   <span class="s">&#34;add a task to the list&#34;</span><span class="p">,</span>
			<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Command</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">sort</span><span class="p">.</span><span class="nf">Sort</span><span class="p">(</span><span class="nx">cli</span><span class="p">.</span><span class="nf">FlagsByName</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span><span class="p">))</span>
	<span class="nx">sort</span><span class="p">.</span><span class="nf">Sort</span><span class="p">(</span><span class="nx">cli</span><span class="p">.</span><span class="nf">CommandsByName</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">Commands</span><span class="p">))</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c1">//Out
</span><span class="c1"></span>	<span class="c1">//COMMANDS:
</span><span class="c1"></span>	<span class="c1">//add, a       add a task to the list
</span><span class="c1"></span>	<span class="c1">//complete, c  complete a task on the list
</span><span class="c1"></span>	<span class="c1">//help, h      Shows a list of commands or help for one command
</span><span class="c1"></span>	<span class="c1">//
</span><span class="c1"></span>	<span class="c1">//GLOBAL OPTIONS:
</span><span class="c1"></span>	<span class="c1">//--config FILE, -c FILE  Load configuration from FILE
</span><span class="c1"></span>	<span class="c1">//--lang value, -l value  Language for the greeting (default: &#34;english&#34;)
</span><span class="c1"></span>	<span class="c1">//--help, -h              show help
</span><span class="c1"></span>	<span class="c1">//--version, -v           print the version
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="从环境变量中获取值">从环境变量中获取值</h2>

<ul>
<li>也可以通过<code>EnvVar</code>从环境变量中获取默认的值，可以使用<code>,</code>分割的方式匹配多个环境变量:</li>
<li>环境变量会按照从前往后的顺序匹配</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;strings&#34;</span>

	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>   <span class="s">&#34;lang, l&#34;</span><span class="p">,</span>
			<span class="nx">Value</span><span class="p">:</span>  <span class="s">&#34;english&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span>  <span class="s">&#34;Language for the greeting&#34;</span><span class="p">,</span>
			<span class="c1">// 可以使用,分割多个环境变量，变量会按照从前往后的顺序匹配
</span><span class="c1"></span>			<span class="nx">EnvVar</span><span class="p">:</span> <span class="s">&#34;APP_LANG,LANG&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;lang&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#34;chinese&#34;</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;lang&#34;</span><span class="p">),</span> <span class="s">&#34;zh_CN&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;你好，工程师&#34;</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello, Engineer&#34;</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c1">//Out
</span><span class="c1"></span>	<span class="c1">//$ make bin &amp;&amp; APP_LANG=english ./bin/watcher # 这里优先匹配 APP_LANG 而非 LANG
</span><span class="c1"></span>	<span class="c1">//go build -o bin/watcher
</span><span class="c1"></span>	<span class="c1">//Hello, Engineer
</span><span class="c1"></span>
	<span class="c1">//$ make bin &amp;&amp; ./bin/watcher
</span><span class="c1"></span>	<span class="c1">//go build -o bin/watcher
</span><span class="c1"></span>	<span class="c1">//你好，工程师
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="从文件中读取配置项">从文件中读取配置项</h2>

<ul>
<li>引入<code>gopkg.in/urfave/cli.v1/altsrc</code>即可从文件中读取配置项</li>
<li><strong>命令行中指定的配置项值优先级高于配置文件中指定的配置项</strong></li>
<li><strong>注意</strong>: <code>altsrc</code>依赖于<code>gopkg.in/urfave/cli.v1</code>，所以使用<code>altsrc</code>的时候，要执行如下的<code>import</code>:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span> <span class="c1">// 从gopkg.in 引入 cli 而非从 GitHub 引入
</span><span class="c1"></span>	<span class="s">&#34;gopkg.in/urfave/cli.v1/altsrc&#34;</span>
<span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>支持从配置文件读取的配置项需要使用<code>altsrc.NewXXXFlag</code>包裹</li>
<li>配置文件也要当做一个配置项写入到<code>app.Flags</code>中</li>
<li>从配置文件添加配置项，需要使用<code>InitInputSourceWithContext</code>进行初始化</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// config 表示配置文件的配置项名称
</span><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">Before</span> <span class="o">:=</span> <span class="nx">altsrc</span><span class="p">.</span><span class="nf">InitInputSourceWithContext</span><span class="p">(</span><span class="nx">flags</span><span class="p">,</span> <span class="nx">altsrc</span><span class="p">.</span><span class="nf">NewYamlSourceFromFlagFunc</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">))</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>目前<code>altsrc</code>仅支持<code>TOML</code>, <code>YAML</code>配置文件，如需要其他格式的配置文件，可自行实现<code>altsrc.InputSourceContext</code></p></li>

<li><p>示例代码</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
	<span class="s">&#34;gopkg.in/urfave/cli.v1/altsrc&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">flags</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">altsrc</span><span class="p">.</span><span class="nf">NewIntFlag</span><span class="p">(</span><span class="nx">cli</span><span class="p">.</span><span class="nx">IntFlag</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;count&#34;</span><span class="p">}),</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;config&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="nx">count</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">)</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Echo %d count\n&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;yml is readed&#34;</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Before</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="nx">BeforeFunc</span> <span class="o">:=</span> <span class="nx">altsrc</span><span class="p">.</span><span class="nf">InitInputSourceWithContext</span><span class="p">(</span><span class="nx">flags</span><span class="p">,</span> <span class="nx">altsrc</span><span class="p">.</span><span class="nf">NewYamlSourceFromFlagFunc</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">))</span>
		<span class="nx">_</span> <span class="p">=</span> <span class="nf">BeforeFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="nx">flags</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>输出</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher
go build -o bin/watcher
Echo <span class="m">0</span> count
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher --count <span class="m">4</span>
go build -o bin/watcher
Echo <span class="m">4</span> count
yml is readed
yml is readed
yml is readed
yml is readed
&gt;&gt;&gt; cat app.yaml
count: <span class="m">10</span>
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher --config ./app.yaml
go build -o bin/watcher
Echo <span class="m">10</span> count
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
yml is readed
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher --config ./app.yaml --count <span class="m">1</span>
go build -o bin/watcher
Echo <span class="m">1</span> count
yml is readed</code></pre></td></tr></table>
</div>
</div>
<h2 id="子命令">子命令</h2>

<ul>
<li>cli 默认为根命令，每个命令可以添加子命令和选项</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Commands</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>    <span class="s">&#34;add&#34;</span><span class="p">,</span>
			<span class="nx">Aliases</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">},</span>
			<span class="nx">Usage</span><span class="p">:</span>   <span class="s">&#34;add a task to the list&#34;</span><span class="p">,</span>
			<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;added task: &#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">First</span><span class="p">())</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>    <span class="s">&#34;complete&#34;</span><span class="p">,</span>
			<span class="nx">Aliases</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;c&#34;</span><span class="p">},</span>
			<span class="nx">Usage</span><span class="p">:</span>   <span class="s">&#34;complete a task on the list&#34;</span><span class="p">,</span>
			<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;completed task: &#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">First</span><span class="p">())</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>    <span class="s">&#34;template&#34;</span><span class="p">,</span>
			<span class="nx">Aliases</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;t&#34;</span><span class="p">},</span>
			<span class="nx">Usage</span><span class="p">:</span>   <span class="s">&#34;options for task templates&#34;</span><span class="p">,</span>
			<span class="nx">Subcommands</span><span class="p">:</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
				<span class="p">{</span>
					<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;add&#34;</span><span class="p">,</span>
					<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;add a new template&#34;</span><span class="p">,</span>
					<span class="nx">Flags</span><span class="p">:</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
						<span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
							<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;path,p&#34;</span><span class="p">,</span>
							<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;template path&#34;</span><span class="p">,</span>
						<span class="p">},</span>
					<span class="p">},</span>
					<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
						<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;new task template: %s from %s\n&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">First</span><span class="p">(),</span> <span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;path&#34;</span><span class="p">))</span>
						<span class="k">return</span> <span class="kc">nil</span>
					<span class="p">},</span>
				<span class="p">},</span>
				<span class="p">{</span>
					<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;remove&#34;</span><span class="p">,</span>
					<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;remove an existing template&#34;</span><span class="p">,</span>
					<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
						<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;removed task template: &#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">First</span><span class="p">())</span>
						<span class="k">return</span> <span class="kc">nil</span>
					<span class="p">},</span>
				<span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher template add -h                                                        <span class="m">17</span>:32:18 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
NAME:
   watcher template add - add a new template

USAGE:
   watcher template add <span class="o">[</span><span class="nb">command</span> options<span class="o">]</span> <span class="o">[</span>arguments...<span class="o">]</span>

OPTIONS:
   --path value, -p value  template path
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher template add -p /tmpdir xff                                            <span class="m">17</span>:32:49 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
new task template: xff from /tmpdir</code></pre></td></tr></table>
</div>
</div>
<h2 id="子命令分类">子命令分类</h2>

<ul>
<li>可以通过<code>Category</code>选项让命令的帮助文本在一组中输出</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Commands</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>     <span class="s">&#34;env&#34;</span><span class="p">,</span>
			<span class="nx">Category</span><span class="p">:</span> <span class="s">&#34;info&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>     <span class="s">&#34;add&#34;</span><span class="p">,</span>
			<span class="nx">Category</span><span class="p">:</span> <span class="s">&#34;template&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>     <span class="s">&#34;remove&#34;</span><span class="p">,</span>
			<span class="nx">Category</span><span class="p">:</span> <span class="s">&#34;template&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -h                                                                     <span class="m">17</span>:37:44 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
NAME:
   watcher - A new cli application

USAGE:
   watcher <span class="o">[</span>global options<span class="o">]</span> <span class="nb">command</span> <span class="o">[</span><span class="nb">command</span> options<span class="o">]</span> <span class="o">[</span>arguments...<span class="o">]</span>

VERSION:
   <span class="m">0</span>.0.0

COMMANDS:
     help, h  Shows a list of commands or <span class="nb">help</span> <span class="k">for</span> one <span class="nb">command</span>
   info:
     env
   template:
     add
     remove

GLOBAL OPTIONS:
   --help, -h     show <span class="nb">help</span>
   --version, -v  print the version</code></pre></td></tr></table>
</div>
</div>
<h2 id="返回码">返回码</h2>

<ul>
<li><code>app.Run</code>默认不会调用<code>os.Exit</code>，所以程序的默认返回码是0</li>
<li>可以在<code>Action</code>指定错误返回值为<code>ExitCoder</code>或<code>MultiError</code>指定程序返回码</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolTFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;ginger-crouton,g&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;is it in the soup?&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">!</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;ginger-crouton&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewExitError</span><span class="p">(</span><span class="s">&#34;it is not in the soup&#34;</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -g<span class="o">=</span><span class="nb">false</span>                                                               <span class="m">17</span>:46:34 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
it is not in the soup
<span class="m">1371</span> <span class="o">(</span>michaeldeMacBook-Air<span class="o">)</span> <span class="m">86</span> ~/Github/Golang/watcher
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -g<span class="o">=</span><span class="m">0</span>                                                                   <span class="m">17</span>:46:36 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
it is not in the soup
<span class="m">1372</span> <span class="o">(</span>michaeldeMacBook-Air<span class="o">)</span> <span class="m">86</span> ~/Github/Golang/watcher
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -g<span class="o">=</span>f                                                                   <span class="m">17</span>:46:38 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
it is not in the soup</code></pre></td></tr></table>
</div>
</div>
<h2 id="生成帮助文本">生成帮助文本</h2>

<ul>
<li>帮助文本的模板通过<code>AppHelpTemplate</code>, <code>CommandHelpTemplate</code>, <code>SubcommandHelpTemplate</code>这三个变量来定义，可以将它们重新赋值来改变帮助文本的样式</li>
<li>也可以改变<code>cli.HelpPrinter</code>来重新定义帮助函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></pre></td>
<td class="lntd">
<pre class="chroma"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// EXAMPLE: Append to an existing template
</span><span class="c1"></span>	<span class="nx">cli</span><span class="p">.</span><span class="nx">AppHelpTemplate</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">`%s
</span><span class="s">
</span><span class="s">WEBSITE: http://awesometown.example.com
</span><span class="s">
</span><span class="s">SUPPORT: support@awesometown.example.com
</span><span class="s">
</span><span class="s">`</span><span class="p">,</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">AppHelpTemplate</span><span class="p">)</span>

	<span class="c1">// EXAMPLE: Override a template
</span><span class="c1"></span>	<span class="nx">cli</span><span class="p">.</span><span class="nx">AppHelpTemplate</span> <span class="p">=</span> <span class="s">`NAME:
</span><span class="s">   </span><span class="cp">{{</span><span class="na">.Name</span><span class="cp">}}</span><span class="s"> - </span><span class="cp">{{</span><span class="na">.Usage</span><span class="cp">}}</span><span class="s">
</span><span class="s">USAGE:
</span><span class="s">   </span><span class="cp">{{</span><span class="na">.HelpName</span><span class="cp">}}</span><span class="s"> </span><span class="cp">{{</span><span class="k">if</span><span class="w"> </span><span class="na">.VisibleFlags</span><span class="cp">}}</span><span class="s">[global options]</span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="na">.Commands</span><span class="cp">}}</span><span class="s"> command [command options]</span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}</span><span class="s"> </span><span class="cp">{{</span><span class="k">if</span><span class="w"> </span><span class="na">.ArgsUsage</span><span class="cp">}}{{</span><span class="na">.ArgsUsage</span><span class="cp">}}{{</span><span class="k">else</span><span class="cp">}}</span><span class="s">[arguments...]</span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}</span><span class="s">
</span><span class="s">   </span><span class="cp">{{</span><span class="k">if</span><span class="w"> </span><span class="k">len</span><span class="w"> </span><span class="na">.Authors</span><span class="cp">}}</span><span class="s">
</span><span class="s">AUTHOR:
</span><span class="s">   </span><span class="cp">{{</span><span class="k">range</span><span class="w"> </span><span class="na">.Authors</span><span class="cp">}}{{</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}{{</span><span class="k">end</span><span class="cp">}}</span><span class="s">
</span><span class="s">   </span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="na">.Commands</span><span class="cp">}}</span><span class="s">
</span><span class="s">COMMANDS:
</span><span class="s"></span><span class="cp">{{</span><span class="k">range</span><span class="w"> </span><span class="na">.Commands</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="na">.HideHelp</span><span class="cp">}}</span><span class="s">   </span><span class="cp">{{</span><span class="nx">join</span><span class="w"> </span><span class="na">.Names</span><span class="w"> </span><span class="s">&#34;, &#34;</span><span class="cp">}}{{</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="cp">}}{{</span><span class="na">.Usage</span><span class="cp">}}{{</span><span class="w"> </span><span class="s">&#34;\n&#34;</span><span class="w"> </span><span class="cp">}}{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="na">.VisibleFlags</span><span class="cp">}}</span><span class="s">
</span><span class="s">GLOBAL OPTIONS:
</span><span class="s">   </span><span class="cp">{{</span><span class="k">range</span><span class="w"> </span><span class="na">.VisibleFlags</span><span class="cp">}}{{</span><span class="na">.</span><span class="cp">}}</span><span class="s">
</span><span class="s">   </span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="na">.Copyright</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span><span class="s">COPYRIGHT:
</span><span class="s">   </span><span class="cp">{{</span><span class="na">.Copyright</span><span class="cp">}}</span><span class="s">
</span><span class="s">   </span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}{{</span><span class="k">if</span><span class="w"> </span><span class="na">.Version</span><span class="cp">}}</span><span class="s">
</span><span class="s">VERSION:
</span><span class="s">   </span><span class="cp">{{</span><span class="na">.Version</span><span class="cp">}}</span><span class="s">
</span><span class="s">   </span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}</span><span class="s">
</span><span class="s">`</span>

	<span class="c1">// EXAMPLE: Replace the `HelpPrinter` func
</span><span class="c1"></span>	<span class="nx">cli</span><span class="p">.</span><span class="nx">HelpPrinter</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">templ</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">data</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Ha HA.  I pwnd the help!!1&#34;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">().</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher                                                                        <span class="m">18</span>:04:34 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
Ha HA.  I pwnd the help!!1</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>help</code>命令的属性可以通过<code>cli.HelpFlag</code>来改变</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">cli</span><span class="p">.</span><span class="nx">HelpFlag</span> <span class="p">=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
		<span class="nx">Name</span><span class="p">:</span>   <span class="s">&#34;halp, haaaaalp&#34;</span><span class="p">,</span>
		<span class="nx">Usage</span><span class="p">:</span>  <span class="s">&#34;HALP&#34;</span><span class="p">,</span>
		<span class="nx">EnvVar</span><span class="p">:</span> <span class="s">&#34;SHOW_HALP,HALPPLZ&#34;</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">().</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher --haaaaalp                                                             <span class="m">18</span>:05:53 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
NAME:
   watcher - A new cli application

USAGE:
   watcher <span class="o">[</span>global options<span class="o">]</span> <span class="nb">command</span> <span class="o">[</span><span class="nb">command</span> options<span class="o">]</span> <span class="o">[</span>arguments...<span class="o">]</span>

VERSION:
   <span class="m">0</span>.0.0

COMMANDS:
     help, h  Shows a list of commands or <span class="nb">help</span> <span class="k">for</span> one <span class="nb">command</span>

GLOBAL OPTIONS:
   --halp, --haaaaalp  HALP <span class="o">[</span><span class="nv">$SHOW_HALP</span>, <span class="nv">$HALPPLZ</span><span class="o">]</span>
   --version, -v       print the version</code></pre></td></tr></table>
</div>
</div>
<h2 id="版本标志">版本标志</h2>

<ul>
<li>默认情况下版本是通过<code>cli.VersionFlag</code>标识符来指定的，在cli内部，<code>cli.VersionPrinter</code>将会获取它来打印<code>App.Version</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></pre></td>
<td class="lntd">
<pre class="chroma"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;os&#34;</span>

	<span class="nx">cli</span> <span class="s">&#34;gopkg.in/urfave/cli.v1&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">cli</span><span class="p">.</span><span class="nx">VersionFlag</span> <span class="p">=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
		<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;print-version, V&#34;</span><span class="p">,</span>
		<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;print only the version&#34;</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;partay&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Version</span> <span class="p">=</span> <span class="s">&#34;19.99.0&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -V                                                                     <span class="m">18</span>:09:26 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
partay version <span class="m">19</span>.99.0
&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -v                                                                     <span class="m">18</span>:09:29 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
Incorrect Usage. flag provided but not defined: -v</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>也可以通过更改<code>cli.VersionPrinter</code>来修改打印 Version 的函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;fmt&#34;</span>
  <span class="s">&#34;os&#34;</span>

  <span class="s">&#34;github.com/urfave/cli&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
  <span class="nx">Revision</span> <span class="p">=</span> <span class="s">&#34;xiaofafa&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cli</span><span class="p">.</span><span class="nx">VersionPrinter</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;version=%s revision=%s\n&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Version</span><span class="p">,</span> <span class="nx">Revision</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;partay&#34;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">Version</span> <span class="p">=</span> <span class="s">&#34;19.99.0&#34;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt;&gt;&gt; make bin <span class="o">&amp;&amp;</span> ./bin/watcher -v                                                                     <span class="m">18</span>:10:12 <span class="o">(</span><span class="m">04</span>-21<span class="o">)</span>
go build -o bin/watcher
<span class="nv">version</span><span class="o">=</span><span class="m">19</span>.99.0 <span class="nv">revision</span><span class="o">=</span>xiaofafa</code></pre></td></tr></table>
</div>
</div>
<h2 id="示例代码">示例代码</h2>

<ul>
<li><a href="https://gist.github.com/bwangelme/078d4dab53b89e06a14572611c6e95e8">Cli 学习示例代码</a></li>
</ul>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">bwangel</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-04-21
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">本博客所有文章除特别声明外，均采用 <a href='http://creativecommons.org/licenses/by-nc-sa/3.0/cn/' rel='external nofollow' target='_blank'>CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/go/">Go</a>
          <a href="/tags/cli/">cli</a>
          <a href="/tags/arts/">ARTS</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/2019/04/27/golang-trick-export-for-test/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Review 《Golang Trick: Export unexport method for test》</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/2019/04/15/review-go-pipelines/">
            <span class="next-text nav-default">Review 《Go Concurrency Patterns: Pipelines and cancellation》</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="anotherbwangel/blog-comment"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:bwangel.me@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/5161084/bwangel" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/bwangel23" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/bwangelme" class="iconfont icon-github" title="github"></a>
      <a href="https://www.douban.com/people/bwangel/" class="iconfont icon-douban" title="douban"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author"><a href='https://bwangel.me/about'>bwangel</a></span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="/lib/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?f22fe9c7aece3dedec2af9976b092478";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
